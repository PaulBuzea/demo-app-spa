<app-header></app-header>
<div class="dashboard">
  <div class="table-container">
    <table class="absence-table">
      <thead>
      <tr>
        <th>ID</th>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Start Date</th>
        <th>End Date</th>
        <th>Action</th>
      </tr>
      </thead>
      <tbody>
      <ng-container *ngFor="let row of rowData">
        <tr [class.feedback-open]="isFeedbackOpen(row.id)">
          <td>{{ row.id }}</td>
          <td>{{ row.firstName }}</td>
          <td>{{ row.lastName }}</td>
          <td>{{ row.startDate | date: 'MMM dd, yyyy' }}</td>
          <td>{{ row.endDate | date: 'MMM dd, yyyy' }}</td>
          <td>
            <button
              *ngIf="!isFeedbackOpen(row.id)"
              class="btn-feedback"
              (click)="openFeedback(row.id)">
              ðŸ’¬ Feedback
            </button>
          </td>
        </tr>

        <!-- Feedback Row (appears below the selected row) -->
        <tr *ngIf="isFeedbackOpen(row.id)" class="feedback-row">
          <td colspan="7">
            <div class="feedback-container">
              <div class="feedback-header">
                <h3>Provide Feedback for {{ row.firstName }} {{ row.lastName }}</h3>
                <button class="btn-close" (click)="closeFeedback()">âœ•</button>
              </div>

              <div class="feedback-body">
                  <textarea
                    [(ngModel)]="feedbackText[row.id]"
                    placeholder="Enter your feedback here..."
                    rows="4"
                    class="feedback-textarea"></textarea>

                <div class="feedback-actions">
                  <button class="btn-cancel" (click)="closeFeedback()">Cancel</button>
                  <button class="btn-submit" (click)="submitFeedback(row.id)">Submit Feedback</button>
                </div>
              </div>
            </div>
          </td>
        </tr>
      </ng-container>
      </tbody>
    </table>

    <div *ngIf="loading" class="loading-message">
      <div class="spinner"></div>
      <p>Loading absences...</p>
    </div>

    <div *ngIf="!loading && rowData.length === 0" class="empty-message">
      <p>No absences found</p>
    </div>
  </div>
</div>
